<!DOCTYPE html><html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Virtual Shirt Try-On</title>
  <style>
    body {
      margin: 0;
      overflow: hidden;
      background-color: #000;
    }
    canvas, video {
      position: absolute;
      top: 0;
      left: 0;
    }
    #shirt {
      display: none;
    }
  </style>
</head>
<body>
  <video id="video" autoplay muted playsinline></video>
  <canvas id="canvas"></canvas>
  <img id="shirt" src="shirt1.png" />  <script type="module">
    import * as poseDetection from 'https://cdn.skypack.dev/@tensorflow-models/pose-detection';
    import { Camera } from 'https://cdn.skypack.dev/@mediapipe/camera_utils';
    import '@tensorflow/tfjs-backend-webgl';

    const video = document.getElementById('video');
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    const shirt = document.getElementById('shirt');

    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
    video.width = window.innerWidth;
    video.height = window.innerHeight;

    const detector = await poseDetection.createDetector(poseDetection.SupportedModels.MoveNet);

    async function setupCamera() {
      const stream = await navigator.mediaDevices.getUserMedia({ video: true });
      video.srcObject = stream;
      return new Promise(resolve => {
        video.onloadedmetadata = () => {
          resolve(video);
        };
      });
    }

    async function detectPose() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      ctx.drawImage(video, 0, 0, canvas.width, canvas.height);

      const poses = await detector.estimatePoses(video);

      if (poses.length > 0) {
        const keypoints = poses[0].keypoints;
        const leftShoulder = keypoints.find(p => p.name === 'left_shoulder');
        const rightShoulder = keypoints.find(p => p.name === 'right_shoulder');

        if (leftShoulder && rightShoulder && leftShoulder.score > 0.4 && rightShoulder.score > 0.4) {
          const x = (leftShoulder.x + rightShoulder.x) / 2;
          const y = (leftShoulder.y + rightShoulder.y) / 2;
          const width = Math.abs(rightShoulder.x - leftShoulder.x) * 1.5;
          const height = width * 1.2;
          ctx.drawImage(shirt, x - width / 2, y - height / 2, width, height);

          // Draw lines (for visual debug)
          ctx.beginPath();
          ctx.strokeStyle = 'red';
          ctx.lineWidth = 2;
          ctx.moveTo(leftShoulder.x, leftShoulder.y);
          ctx.lineTo(rightShoulder.x, rightShoulder.y);
          ctx.stroke();
        }
      }

      requestAnimationFrame(detectPose);
    }

    await setupCamera();
    detectPose();
  </script></body>
</html>
